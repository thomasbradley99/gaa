# Ground Truth XML Workflow

## Overview

Ground truth XML files contain professional event annotations for GAA matches. These are used to evaluate AI-generated event detection accuracy.

## File Structure

### Input Files (in `games/{game-name}/inputs/`)

1. **`ground_truth_template.xml`** (Full game, all events)
   - Contains ALL events including meta events (Ball in Play, Highlight, Stoppage, etc.)
   - Typically 400-500+ events for a full match
   - Source: Exported from Anadi system or manually annotated

2. **`ground_truth_detectable_events.xml`** (Filtered, detectable events only)
   - Contains only events that AI can detect (as defined in `schema_gaa_evaluation.json`)
   - Excludes meta/arbitrary events
   - Generated by `filter_ground_truth_xml.py` script

### Schema Files (in `schemas/`)

- **`schema_gaa_evaluation.json`** - Defines which events are evaluable
  - `actions`: List of detectable event codes
  - `excluded_events`: Meta events to exclude (with reasons)

## Workflow

### Step 1: Import Ground Truth

1. Export XML from Anadi system (or manually annotate)
2. Save as `games/{game-name}/inputs/ground_truth_template.xml`
3. Update `ground_truth_notes.txt` with source information

### Step 2: Filter to Detectable Events

```bash
cd pipelines/production1
python3 filter_ground_truth_xml.py --game cmull-vs-castleconnor
```

This creates `ground_truth_detectable_events.xml` with only evaluable events.

### Step 3: Evaluation

The evaluation script (`7_evaluate.py`) will:
- Prefer `ground_truth_detectable_events.xml` if it exists
- Otherwise filter `ground_truth_template.xml` on-the-fly using schema

## Event Categories

### Detectable Events (Evaluated)
- Possession events (Own/Opp, Pos Own Att, Pos Opp ATT)
- Attack events (Attack Own, Attack OPP)
- Shots (Shot Own/Opp with outcomes)
- Restarts (Kickout Own/Opp, Throw Up)
- Turnovers (Turnover Won/Turnover lost)
- Fouls (Foul Awarded/Conceded, Scoreable Fouls)
- Match structure (Half Start/End)

### Excluded Events (Not Evaluated)
- **Ball in Play**: Continuous state, not discrete event
- **Stoppage**: Can be inferred from scores/kickouts
- **Highlight**: Arbitrary marker, subjective
- **Referee**: Can be inferred from fouls
- **Hot Ball**: Subjective assessment

## XML Format

See `ANADI_XML_FORMAT_SPEC.md` for complete XML structure specification.

### Required Fields
- `<ID>`: Unique numeric identifier
- `<start>`: Start time in seconds (float)
- `<end>`: End time in seconds (float)
- `<code>`: Event type code (must match schema)

### Optional Fields
- `<label><group>...</group><text>...</text></label>`: Tags/attributes

## Example

```xml
<instance>
  <ID>1</ID>
  <start>546.0</start>
  <end>551.0</end>
  <code>Shot Opp</code>
  <label>
    <group>Tags</group>
    <text>From Play</text>
  </label>
  <label>
    <group>Tags</group>
    <text>Point</text>
  </label>
</instance>
```

## Notes

- Ground truth should cover full match time range
- Events should be chronologically ordered
- Timestamps should match video timestamps
- Tags provide additional context (e.g., "From Play", "Point", "Won", etc.)

