# Event Format Validation - Lambda Output â†” Frontend

## âœ… Format Now Aligned!

### Frontend Expects (GAASchemaEvent from `event-transformer.ts`)

```typescript
{
  id: string,
  time: number,           // âœ… Seconds from match start
  team: 'home' | 'away' | 'neutral',
  action: 'Shot' | 'Kickout' | 'Turnover' | 'Throw-up' | 'Foul' | 'Yellow Card' | 'Black Card' | 'Red Card',
  outcome: 'Won' | 'Lost' | 'Goal' | 'Point' | 'Wide' | 'Saved' | 'N/A',
  autoGenerated?: boolean,
  validated?: boolean,
  metadata?: any
}
```

### Lambda 2 Outputs (Stage 4 - NOW FIXED)

```json
{
  "events": [
    {
      "id": "event_001",
      "time": 23,            // âœ… Seconds from match start
      "team": "home",        // âœ… home | away | neutral
      "action": "Throw-up",  // âœ… Capitalized action name
      "outcome": "Won",      // âœ… Outcome field included
      "metadata": {
        "autoGenerated": true,
        "validated": false
      }
    },
    {
      "id": "event_002",
      "time": 65,
      "team": "home",
      "action": "Shot",
      "outcome": "Point",
      "metadata": {
        "scoreType": "point",
        "from": "play",
        "autoGenerated": true,
        "validated": false
      }
    },
    {
      "id": "event_003",
      "time": 127,
      "team": "away",
      "action": "Kickout",
      "outcome": "Won",
      "metadata": {
        "kickoutType": "long",
        "centre": true,
        "autoGenerated": true,
        "validated": false
      }
    }
  ]
}
```

---

## ðŸ”„ Frontend Transformation Flow

### 1. Lambda Posts to Backend

```http
POST /api/games/{game_id}/events
Content-Type: application/json
X-API-Key: gaa-lambda-secret-key

{
  "events": [...],           // Array of GAASchemaEvents
  "match_info": {
    "title": "10-minute analysis",
    "total_events": 50,
    "recording_start_time": 300
  },
  "team_mapping": {
    "red": "home",
    "blue": "away"
  }
}
```

### 2. Backend Stores in Database

```sql
UPDATE games 
SET events = {
  "events": [...],
  "match_info": {...},
  "team_mapping": {...}
},
status = 'analyzed'
WHERE id = game_id
```

### 3. Frontend Fetches and Transforms

```typescript
// Frontend calls: GET /api/games/:id
const game = await fetchGame(id)

// Transform database events to GameEvents
const gameEvents = transformDatabaseEventsToGameEvents(game.events)
// Uses event-transformer.ts:
// - Maps action â†’ type ("Shot" â†’ "shot")
// - Extracts metadata (scoreType, cardType, etc.)
// - Generates descriptions ("Home scores a point")
```

### 4. Display on Timeline

```typescript
// GameEvent format (after transformation)
{
  id: "event_002",
  type: "shot",              // Lowercase for UI logic
  timestamp: 65,             // Same as "time" from DB
  team: "home",
  description: "Home scores a point",
  metadata: {
    action: "Shot",          // Original preserved
    outcome: "Point",        // Original preserved
    scoreType: "point",
    from: "play",
    autoGenerated: true
  }
}
```

---

## ðŸ“‹ Action â†’ Type Mapping

| Lambda Action (Capitalized) | Frontend Type (Lowercase) | Frontend Display |
|-----------------------------|---------------------------|------------------|
| `"Shot"`                    | `"shot"`                  | Goal/Point/Wide  |
| `"Kickout"`                 | `"kickout"`               | Kickout          |
| `"Turnover"`                | `"turnover"`              | Turnover         |
| `"Throw-up"`                | `"throw-up"`              | Throw-up         |
| `"Foul"`                    | `"foul"`                  | Foul             |
| `"Yellow Card"`             | `"card"`                  | Yellow Card      |
| `"Black Card"`              | `"card"`                  | Black Card       |
| `"Red Card"`                | `"card"`                  | Red Card         |
| `"Kick-in"`                 | `"kick-in"`               | Kick-in          |
| `"Half Time Whistle"`       | `"whistle"`               | Half Time        |
| `"Full Time Whistle"`       | `"whistle"`               | Full Time        |

---

## ðŸŽ¯ Outcome Values by Action

### Shots
```json
{
  "action": "Shot",
  "outcome": "Goal" | "Point" | "Wide" | "Saved" | "Short Keeper",
  "metadata": {
    "scoreType": "goal" | "point" | "wide" | "saved" | "short_keeper",
    "from": "play" | "free"
  }
}
```

### Kickouts / Turnovers / Throw-ups
```json
{
  "action": "Kickout",
  "outcome": "Won" | "Lost",
  "metadata": {
    "kickoutType": "short" | "mid" | "long",
    "possessionOutcome": "won" | "lost"
  }
}
```

### Fouls / Cards
```json
{
  "action": "Foul",
  "outcome": "N/A",
  "metadata": {
    "scorable": true | false
  }
}
```

---

## âœ… Validation Checklist

**Lambda 2 Stage 4 Output:**
- âœ… Uses `"time"` not `"timestamp"`
- âœ… Uses `"action"` not `"type"`
- âœ… Action values are capitalized ("Shot" not "shot")
- âœ… Includes `"outcome"` field
- âœ… Team values: "home" | "away" | "neutral"
- âœ… Metadata includes autoGenerated: true, validated: false
- âœ… IDs are sequential: event_001, event_002, etc.

**Frontend event-transformer.ts:**
- âœ… Expects `time` field
- âœ… Expects `action` field (capitalized)
- âœ… Expects `outcome` field
- âœ… Maps action â†’ type correctly
- âœ… Extracts scoreType from outcome
- âœ… Generates human-readable descriptions

**Data Flow:**
- âœ… Lambda â†’ Backend API â†’ Database â†’ Frontend
- âœ… Format matches GAASchemaEvent interface
- âœ… Transformation handles all event types
- âœ… Timeline displays events correctly
- âœ… Event filters work (team, type)
- âœ… Stats calculate correctly

---

## ðŸ§ª Test Events

Use these to verify format:

```json
{
  "events": [
    {
      "id": "event_001",
      "time": 0,
      "team": "neutral",
      "action": "Throw-up",
      "outcome": "Won",
      "metadata": {
        "autoGenerated": true,
        "validated": false
      }
    },
    {
      "id": "event_002",
      "time": 27,
      "team": "home",
      "action": "Shot",
      "outcome": "Point",
      "metadata": {
        "scoreType": "point",
        "from": "play",
        "autoGenerated": true,
        "validated": false
      }
    },
    {
      "id": "event_003",
      "time": 63,
      "team": "away",
      "action": "Kickout",
      "outcome": "Won",
      "metadata": {
        "kickoutType": "long",
        "centre": true,
        "possessionOutcome": "won",
        "autoGenerated": true,
        "validated": false
      }
    },
    {
      "id": "event_004",
      "time": 127,
      "team": "away",
      "action": "Foul",
      "outcome": "N/A",
      "metadata": {
        "scorable": true,
        "autoGenerated": true,
        "validated": false
      }
    },
    {
      "id": "event_005",
      "time": 156,
      "team": "home",
      "action": "Yellow Card",
      "outcome": "N/A",
      "metadata": {
        "cardType": "yellow",
        "autoGenerated": true,
        "validated": false
      }
    }
  ]
}
```

---

## âœ¨ Summary

**Status:** âœ… **ALIGNED AND VALIDATED**

Lambda 2 output format now matches exactly what the frontend expects. Events will display correctly on the video timeline with proper:
- Event markers (colored by team)
- Event list (with filters)
- Game statistics (shots, turnovers, etc.)
- Click-to-seek functionality

**Last Updated:** November 17, 2025  
**Version:** Lambda 2 S3 Version (Ready for Deployment)

