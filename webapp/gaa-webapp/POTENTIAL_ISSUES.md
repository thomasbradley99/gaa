# Potential Issues & Edge Cases Analysis

**Date:** November 18, 2025  
**Purpose:** Comprehensive list of potential problems beyond team colors

---

## üî¥ CRITICAL (Must Fix)

### 1. **Team Colors Not Displayed** ‚ö†Ô∏è KNOWN ISSUE
**Status:** Documented in `DATA_CONTRACT.md`  
**Impact:** High - affects visual clarity  
**Fix:** Lambda must send `metadata.teams` with jersey colors

---

### 2. **Event Timestamps May Be Wrong**

**Problem:** Lambda analyzes first 10 minutes, but when does the match actually start?

**Current Flow:**
```python
# Lambda Stage 0.5: Detect match start time
match_start_time = 300  # e.g., 5 minutes into recording

# Lambda then analyzes clips from match_start_time
# But does it adjust event timestamps?
```

**Question:** Do event timestamps in the database represent:
- A) Time from **recording start** (0:00)?
- B) Time from **match start** (0:00 = when ball is thrown up)?

**Frontend expects:** Time from recording start (to sync with video playback)

**Potential Issue:** If Lambda returns timestamps relative to match start, but frontend seeks to recording start, events won't sync.

**Example:**
- Recording starts at 0:00
- Match starts at 5:00 (300 seconds)
- First goal at 5:23 (23 seconds after throw-up)
- Lambda posts: `"time": 23` (relative to match start)
- Frontend seeks video to 0:23 ‚Üí **WRONG! Should be 5:23**

**Check Lambda Code:**
```python
# In lambda_handler_s3.py, around event extraction
# Are event times adjusted by match_start_time?
# Or do they need to be?
```

**Fix if needed:**
```python
# When posting events to backend
for event in events_json['events']:
    event['time'] += match_start_time  # Adjust to recording time
```

---

### 3. **Video Duration Mismatch**

**Problem:** Lambda only analyzes first 10 minutes, but video is 90+ minutes

**Current State:**
- Database stores ~137 events (from 10-minute analysis)
- But video is full match (e.g., 90 minutes)
- Frontend shows timeline for entire video
- First 10 minutes have events, rest is empty

**Issues:**
- User might think analysis is complete when it's not
- No indication that only first 10 minutes are analyzed
- Confusing UX - "Where are the goals from second half?"

**Potential Fix:**
1. Show a progress indicator: "Analyzed: 10:00 / 90:00"
2. Add `analysis_coverage` to `match_info`:
   ```json
   {
     "match_info": {
       "analysis_start_time": 300,
       "analysis_end_time": 900,
       "analysis_duration": "10 minutes",
       "total_video_duration": "90 minutes",
       "coverage_percentage": 11
     }
   }
   ```
3. Frontend displays: "‚ö†Ô∏è Only first 10 minutes analyzed"

---

### 4. **Demo Game vs Real Game Inconsistency**

**Problem:** Demo game on landing page has different data structure

**Evidence from errors:**
```javascript
// page.tsx:144 - Transformed events sample
TypeError: allEvents.filter is not a function
// Because DEMO_GAME_DATA.events was an object, not array
```

**Risk:** If demo data structure drifts from real data, features break only on demo page

**Fix:** Use same transformer for both:
```typescript
// Already fixed, but watch for future drift
const demoEvents = transformDatabaseEventsToGameEvents(DEMO_GAME_DATA.events)
```

---

## ‚ö†Ô∏è MEDIUM (Should Fix Soon)

### 5. **HLS Streaming Not Implemented**

**Current State:**
- Database has `hls_url` field
- VideoPlayer checks for `game.hls_url`
- But Lambda doesn't generate HLS manifests
- Only MP4 files uploaded to S3

**Impact:**
- Large videos (2.7GB) take forever to start playback
- No adaptive bitrate streaming
- Poor mobile experience

**Fix Options:**
1. **AWS MediaConvert:** Transcode MP4 ‚Üí HLS
2. **FFmpeg in Lambda:** Generate HLS manifests (needs larger Lambda)
3. **CloudFront:** Use CloudFront to stream MP4 directly

**Recommended:** AWS MediaConvert (built for this)

---

### 6. **Presigned URLs Expire After 1 Hour**

**Current Code:**
```javascript
// backend/routes/games.js
const presignedUrl = await getPresignedDownloadUrl(game.s3_key);
game.video_url = presignedUrl; // Expires in 1 hour
```

**Issue:** If user opens video, then comes back 2 hours later, video URL is dead

**Fix Options:**
1. **Frontend re-fetches game data when URL fails**
2. **Extend expiry to 12 hours** (less secure)
3. **Backend endpoint to refresh URL:** `GET /api/games/:id/video-url`

**Recommended:** Option 1 - Frontend catches error and refetches

---

### 7. **No Event Validation Status Display**

**Current State:**
- Events have `validated: false, autoGenerated: true` flags
- But frontend doesn't show these
- User can't tell which events are AI-generated vs human-verified

**Impact:**
- No indication of data quality
- Can't prioritize which events to review
- No "Review Queue" workflow

**Potential Fix:**
```typescript
// Show badge on unvalidated events
{!event.metadata.validated && (
  <span className="text-xs bg-yellow-500/20 text-yellow-500 px-2 py-1 rounded">
    ‚ö†Ô∏è AI Generated
  </span>
)}
```

---

### 8. **Team Mapping Edge Cases**

**Problem:** What if Lambda detects colors wrong?

**Scenario:**
```python
# Lambda detects:
team_a_color = "blue"  # Actually away team
team_b_color = "green" # Actually home team

# Lambda posts:
team_mapping = {
  "red": "home",  # But "red" = blue jerseys?
  "blue": "away"
}
```

**Questions:**
- How does Lambda decide which color is "red" vs "blue"?
- Is there a way to flip the mapping if it's wrong?
- Should users be able to manually adjust?

**Potential Fix:**
- Add "Swap Teams" button in edit mode
- Updates `game.events.team_mapping`

---

### 9. **Score Calculation Depends on Event Quality**

**Current Code:**
```typescript
// lib/score-calculator.ts
calculateScore(events)
// Counts: action === 'Shot' && outcome === 'Point'
```

**Risk:** If AI misses shots or miscategorizes outcomes, score is wrong

**Example:**
- Actual score: Home 2-15 (2 goals, 15 points)
- AI detected: Home 2-12 (missed 3 points)
- Frontend shows: Home 2-12 ‚ùå

**Potential Fix:**
- Add manual score override in game metadata
- Display: "Calculated: 2-12 | Actual: 2-15 (edit)"

---

### 10. **Mobile Scrolling Issues (Already Fixed)**

**Status:** Fixed in recent commit  
**Issue:** Events list wasn't scrollable on mobile  
**Fix:** Added `overflow-hidden` and `min-h-0` to flex containers

**Watch for:** Similar issues on other mobile views (stats tab, coach tab)

---

### 11. **Autoplay Mode Padding Not Persisted**

**Current State:**
- User can adjust event padding (before/after) using trimmer
- But these aren't saved to database automatically
- If page refreshes, paddings reset to default (5s/5s)

**Expected Behavior:**
- User adjusts padding
- Clicks "Save Changes" (in edit mode)
- Paddings saved to `event.metadata.beforePadding`, `event.metadata.afterPadding`

**Check:** Does current implementation save paddings?

---

## üí° LOW PRIORITY (Nice to Have)

### 12. **No Keyboard Shortcuts Documentation**

**Current Shortcuts:**
- Space: Play/Pause
- Arrow Left: Previous event
- Arrow Right: Next event

**Issue:** Users don't know these exist

**Fix:** Add a "?" button that shows keyboard shortcuts overlay

---

### 13. **No Video Quality Indicator**

**Issue:** User can't tell if video is loading slowly due to:
- Poor network
- Large file size
- Server issue

**Fix:** Show loading indicator with estimated time or buffering percentage

---

### 14. **No Thumbnail Fallback**

**Current State:**
- If `thumbnail_key` is null, no thumbnail displays
- Game card shows blank/broken image

**Fix:**
```typescript
// GameCard.tsx
{game.thumbnail_url ? (
  <img src={game.thumbnail_url} alt={game.title} />
) : (
  <div className="bg-gray-800 flex items-center justify-center">
    üèê GAA
  </div>
)}
```

---

### 15. **No Player Names in Events**

**Current State:**
- Events have `player?: string` field
- But Lambda doesn't detect player names (yet)
- Users can manually add in edit mode

**Future Enhancement:** Use jersey number detection + OCR

---

### 16. **No Multi-Team Support in UI**

**Current State:**
- User belongs to one team (e.g., "Allen Gaels")
- Can only see games for that team
- Dashboard shows "Allen Gaels Games"

**Future:** User coaches multiple teams
- Need team switcher in dashboard
- Or "All Teams" view

---

### 17. **AI Chat Doesn't Reference Specific Events**

**Current State:**
- AI coach gets game context (stats, recent events)
- But can't reference specific event IDs
- User asks: "Was that last shot a good attempt?"
- AI doesn't know which shot

**Enhancement:**
```typescript
// When user clicks event, add to chat context
onEventClick(event) {
  setChatContext({ selectedEvent: event })
  // AI now knows which event user is viewing
}
```

---

## üîç TESTING CHECKLIST

Before considering this "production ready":

1. ‚úÖ Team colors display correctly
2. ‚ö†Ô∏è Event timestamps sync with video playback
3. ‚ö†Ô∏è Video duration vs analysis coverage is clear
4. ‚ö†Ô∏è HLS streaming works for large videos
5. ‚ö†Ô∏è Presigned URLs refresh when expired
6. ‚ö†Ô∏è Score calculation matches actual game score
7. ‚úÖ Mobile scrolling works on all tabs
8. ‚ö†Ô∏è Event paddings persist after save
9. ‚ö†Ô∏è Thumbnail fallback displays for games without thumbnails
10. ‚ö†Ô∏è Team mapping can be manually corrected if Lambda gets it wrong

---

## üö® MOST LIKELY TO CAUSE USER CONFUSION

### **Priority 1:**
1. **Team Colors** - Already documented, easy fix
2. **Event Timestamp Sync** - Could break entire video experience
3. **Partial Analysis Warning** - User thinks it's broken

### **Priority 2:**
4. **Presigned URL Expiry** - Video stops working after 1 hour
5. **HLS Streaming** - Slow playback on large files

### **Priority 3:**
6. **Score Accuracy** - Wrong scores undermine trust
7. **Team Mapping** - Can't fix if Lambda detects colors wrong

---

## üìã RECOMMENDED NEXT STEPS

1. **Fix team colors** (20 lines in Lambda)
2. **Verify event timestamp handling** (check Lambda code)
3. **Add analysis coverage indicator** (frontend banner)
4. **Test presigned URL refresh** (frontend error handling)
5. **Implement HLS transcoding** (AWS MediaConvert)

---

**Want me to investigate any of these in detail?** 

Most critical to check first: **Event timestamp handling** - if this is wrong, the entire video experience breaks! üéØ

