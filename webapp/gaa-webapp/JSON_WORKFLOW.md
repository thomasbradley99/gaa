# JSON Upload/Edit/Export Workflow

**Status:** ✅ Complete and Deployed

---

## What You Can Do Now

### 1. Upload JSON File
**Location:** Game Detail Page → Stats Tab → Edit Mode

**Steps:**
1. Go to any game page
2. Click **"Edit Events"** button (top right)
3. Click **"Upload JSON File"** button
4. Select your JSON file
5. Events are **immediately saved to database**

**Supported Formats:**
```json
// Direct array
[
  { "id": "event_1", "time": 23, "action": "Shot", "outcome": "Point", ... }
]

// Nested (events key)
{
  "events": [
    { "id": "event_1", "time": 23, ... }
  ]
}

// Nested (data key)
{
  "data": [
    { "id": "event_1", "time": 23, ... }
  ]
}
```

---

### 2. Edit Events
**Location:** Same Edit Mode

**What You Can Edit:**
- ✅ Add new events
- ✅ Delete events (bin icon)
- ✅ Modify event type (Shot/Kickout/etc.)
- ✅ Change team (Home/Away)
- ✅ Adjust timing
- ✅ Edit descriptions

**How to Save:**
1. Make your changes
2. Click **"Save Changes"** button
3. Events are **saved to database**
4. Page refreshes with updated data

---

### 3. Export JSON
**Location:** Game Detail Page → Stats Tab

**Steps:**
1. Go to any game page
2. Click **"Export JSON"** button (top right, next to Export PDF)
3. Downloads: `{game_title}_events.json`

**Export Format:**
```json
{
  "title": "Kilmeena vs Opposition",
  "events": [
    {
      "id": "event_1",
      "time": 23,
      "team": "home",
      "action": "Throw-up",
      "outcome": "Won",
      "metadata": {
        "validated": false,
        "autoGenerated": true
      }
    },
    // ... all events
  ],
  "exported_at": "2025-11-20T12:00:00.000Z"
}
```

---

## Complete Workflow

```
┌─────────────────────────────────────────────────┐
│ 1. UPLOAD JSON                                   │
│    - Select file                                 │
│    - Parses & validates                          │
│    - Saves to PostgreSQL (games.events)         │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│ 2. EDIT EVENTS                                   │
│    - Add/delete/modify events                    │
│    - Visual timeline adjustments                 │
│    - Click "Save Changes"                        │
│    - Updates PostgreSQL                          │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│ 3. EXPORT JSON                                   │
│    - Click "Export JSON" button                  │
│    - Downloads current events from DB            │
│    - File includes all edits                     │
└─────────────────────────────────────────────────┘
```

---

## Technical Details

### Frontend Components
- **`JsonUpload.tsx`** - Handles file selection, parsing, and API calls
- **`GameStats.tsx`** - Export JSON button
- **`UnifiedSidebar.tsx`** - Edit mode and save functionality

### Backend Endpoints
- **`PUT /api/games/:id/events`** - Save edited events (already existed)
- Uses existing authentication

### Data Format
All events use **Master Schema** (`shared/EVENT_SCHEMA.ts`):
```typescript
{
  id: string
  time: number              // Absolute video time (seconds)
  team: "home" | "away"
  action: EventAction       // "Shot" | "Kickout" | "Turnover" | etc.
  outcome: EventOutcome     // "Point" | "Wide" | "Won" | etc.
  metadata?: EventMetadata
}
```

---

## Example Usage

### Upload Your JSON
```json
{
  "events": [
    {
      "id": "event_1",
      "time": 10,
      "team": "home",
      "action": "Shot",
      "outcome": "Point",
      "metadata": {
        "from": "play",
        "scoreType": "point"
      }
    }
  ]
}
```

### Edit in UI
- Change "Point" to "Wide"
- Add more events
- Delete bad detections
- **Save Changes**

### Export Result
- Click "Export JSON"
- Get updated file with all your edits
- Use for further analysis or import to other games

---

## Notes

✅ **Instant Save** - Upload saves directly to DB (not just UI)  
✅ **Master Schema** - All events use consistent format  
✅ **Flexible Import** - Handles nested or flat JSON  
✅ **Edit History** - Marks events as `userEdited: true`  
✅ **No Data Loss** - All edits persisted to database

**Commit:** `6977df7` + `1555419`

---

**Ready to use!** Just upload your JSON file and start editing.

